<!DOCTYPE html><html lang="en"><head><title>Runtime</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="Runtime"><meta name="groc-project-path" content="src/Runtime.coffee"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">src/Runtime.coffee</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="cm">###</span>
<span class="cm">Â© Copyright 2013 Stephan Jorek &lt;stephan.jorek@gmail.com&gt;</span>

<span class="cm">Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
<span class="cm">you may not use this file except in compliance with the License.</span>
<span class="cm">You may obtain a copy of the License at</span>

<span class="cm">http://www.apache.org/licenses/LICENSE-2.0</span>

<span class="cm">Unless required by applicable law or agreed to in writing, software</span>
<span class="cm">distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
<span class="cm">WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or</span>
<span class="cm">implied. See the License for the specific language governing</span>
<span class="cm">permissions and limitations under the License.</span>
<span class="cm">###</span>

<span class="p">{</span><span class="nx">Expression</span><span class="p">}</span>    <span class="o">=</span> <span class="nx">require</span> <span class="s">&#39;./Expression&#39;</span>

<span class="p">{</span><span class="nx">Utility</span><span class="o">:</span><span class="p">{</span>
  <span class="nx">arraySlice</span><span class="p">,</span>
  <span class="nx">bindFunction</span><span class="p">,</span>
  <span class="nx">isString</span><span class="p">,</span>
  <span class="nx">isArray</span><span class="p">,</span>
  <span class="nx">isNumber</span><span class="p">,</span>
  <span class="nx">isFunction</span><span class="p">,</span>
  <span class="nx">isExpression</span><span class="p">,</span>
  <span class="nx">parse</span>
<span class="p">}}</span>              <span class="o">=</span> <span class="nx">require</span> <span class="s">&#39;./Utility&#39;</span>

<span class="nv">exports = </span><span class="nx">module</span><span class="o">?</span><span class="p">.</span><span class="nx">exports</span> <span class="o">?</span> <span class="k">this</span>

<span class="c1">##</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'> </span></p></div></div><div class="code"><div class="wrapper"><span class="nv">exports.Runtime = </span><span class="k">class</span> <span class="nx">Runtime</span>

  <span class="nv">_operations = </span><span class="nx">Expression</span><span class="p">.</span><span class="nx">operations</span>

  <span class="c1">##</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'></span></p>

<p><strong>Returns an Array</strong></p></div></div><div class="code"><div class="wrapper">  <span class="nv">Runtime.aliases  = _aliases = </span><span class="nx">do</span> <span class="nf">-&gt;</span>
    <span class="nv">index = </span><span class="kc">null</span>
    <span class="p">()</span> <span class="nf">-&gt;</span>
      <span class="nx">index</span> <span class="o">?</span> <span class="nv">index = </span><span class="s">&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ$_&#39;</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

  <span class="c1">##</span></div></div></div><div class="segment"><div class="comments doc-section"><div class="wrapper"><p><span class='doc-section-header'></span></p>

<p>Parameters:</p>

<ul>
<li><strong>compress must be a Boolean.</strong><br/>(, default: on)</li>
</ul>

<p><strong>Returns a String</strong></p></div></div><div class="code"><div class="wrapper">  <span class="nv">Runtime.generate = </span><span class="nx">do</span> <span class="nf">-&gt;</span>

    <span class="nv">aliases     = </span><span class="p">[]</span>
    <span class="k">for</span> <span class="nx">alias</span> <span class="k">in</span> <span class="nx">_aliases</span><span class="p">().</span><span class="nx">reverse</span><span class="p">()</span> <span class="k">when</span> <span class="o">not</span> <span class="nx">_operations</span><span class="p">[</span><span class="nx">alias</span><span class="p">]</span><span class="o">?</span>
      <span class="nx">aliases</span><span class="p">.</span><span class="nx">push</span> <span class="nx">alias</span>
    <span class="nv">index       = </span><span class="nx">aliases</span><span class="p">.</span><span class="nx">length</span>

    <span class="k">return</span> <span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span>

    <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">_operations</span> <span class="k">when</span> <span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="o">?</span> <span class="o">and</span> <span class="o">not</span> <span class="nx">value</span><span class="p">.</span><span class="nx">alias</span><span class="o">?</span>
      <span class="nx">_operations</span><span class="p">[</span><span class="nv">value.alias = </span><span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]]</span> <span class="o">=</span> <span class="nx">key</span>
      <span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span>
        <span class="k">break</span>

    <span class="nx">_operations</span><span class="p">[</span><span class="s">&#39;()&#39;</span><span class="p">].</span><span class="nv">code = </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">      function(){</span>
<span class="s">        var a,f;</span>
<span class="s">        f=arguments[0],a=2&lt;=arguments.length?aS(arguments,1):[];</span>
<span class="s">        return f.apply(this,a);</span>
<span class="s">      }</span>
<span class="s">      &quot;&quot;&quot;</span>

    <span class="nv">runtime =</span>

      <span class="nv">global        :</span>
        <span class="nv">name        : </span><span class="s">&#39;global&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;_g&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&#39;null&#39;</span>

      <span class="nv">local         :</span>
        <span class="nv">name        : </span><span class="s">&#39;local&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;_l&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&#39;null&#39;</span>

      <span class="nv">stack         :</span>
        <span class="nv">name        : </span><span class="s">&#39;stack&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;st&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&#39;[]&#39;</span>

      <span class="nv">scope         :</span>
        <span class="nv">name        : </span><span class="s">&#39;scope&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;sc&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&#39;[]&#39;</span>

      <span class="nv">evaluate      :</span>
        <span class="nv">name        : </span><span class="s">&#39;evaluate&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;_e&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                      function(c,e,v,_,$) {</span>
<span class="s">                        var g,r;</span>
<span class="s">                        if(!(isFunction(e) &amp;&amp; e.name)){return e;}</span>
<span class="s">                        g = _global === null ? _evaluate : false;</span>
<span class="s">                        if (g) {</span>
<span class="s">                          _global   = c||{};</span>
<span class="s">                          _local    = v||{};</span>
<span class="s">                          _scope    = _||_scope.length = 0||_scope;</span>
<span class="s">                          _stack    = $||_stack.length = 0||_stack;</span>
<span class="s">                          _evaluate = _execute;</span>
<span class="s">                        };</span>
<span class="s">                        r = _execute(c,e);</span>
<span class="s">                        if (g) {</span>
<span class="s">                          _global   = null;</span>
<span class="s">                          _evaluate = g;</span>
<span class="s">                        };</span>
<span class="s">                        return r;</span>
<span class="s">                      }</span>
<span class="s">                      &quot;&quot;&quot;</span>
        <span class="nv">evaluate    : </span><span class="nx">Expression</span><span class="p">.</span><span class="nx">evaluate</span>

      <span class="nv">execute       :</span>
        <span class="nv">name        : </span><span class="s">&#39;execute&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;_x&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                      function(c,e) {</span>
<span class="s">                        var r,f;</span>
<span class="s">                        if(!(isFunction(e) &amp;&amp; e.name)){return e;};</span>
<span class="s">                        _scope.push(c);</span>
<span class="s">                        _stack.push(e);</span>
<span class="s">                        try {</span>
<span class="s">                          r = _process(c,e); /* ?!?!?!?! */</span>
<span class="s">                        } catch(f) {};</span>
<span class="s">                        _scope.pop();</span>
<span class="s">                        _stack.pop();</span>
<span class="s">                        return r;</span>
<span class="s">                      }</span>
<span class="s">                      &quot;&quot;&quot;</span>
        <span class="nv">evaluate    : </span><span class="nx">Expression</span><span class="p">.</span><span class="nx">execute</span>

      <span class="nv">call          :</span>
        <span class="nv">name        : </span><span class="s">&#39;call&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;ca&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&#39;Function.prototype.call&#39;</span>

      <span class="nv">slice         :</span>
        <span class="nv">name        : </span><span class="s">&#39;slice&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;sl&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&#39;Array.prototype.slice&#39;</span>

      <span class="nv">toString      :</span>
        <span class="nv">name        : </span><span class="s">&#39;toString&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;tS&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&#39;Object.prototype.toString&#39;</span>

      <span class="nv">booleanize    :</span>
        <span class="nv">name        : </span><span class="s">&#39;booleanize&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;_b&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">evaluate    : </span><span class="nx">Expression</span><span class="p">.</span><span class="nx">booleanize</span>

      <span class="nv">isFunction    :</span>
        <span class="nv">name        : </span><span class="s">&#39;isFunction&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;iF&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">evaluate    : </span><span class="nx">isFunction</span>

      <span class="nv">bindFunction  :</span>
        <span class="nv">name        : </span><span class="s">&#39;bindFunction&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;bF&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                      (function(bindFunction) {</span>
<span class="s">                        return bindFunction ? function() {</span>
<span class="s">                            return bindFunction.apply(arguments);</span>
<span class="s">                          } : function() {</span>
<span class="s">                            var f, c, a;</span>
<span class="s">                            f = arguments[0];</span>
<span class="s">                            c = arguments[1];</span>
<span class="s">                            a = 3 &lt;= arguments.length ? arraySlice(arguments, 2) : [];</span>
<span class="s">                            return a.length === 0</span>
<span class="s">                              ? function() { return f.call(c); }</span>
<span class="s">                              : function() { return f.apply(c, a); };</span>
<span class="s">                          }</span>
<span class="s">                      })(Function.prototype.bind)</span>
<span class="s">                      &quot;&quot;&quot;</span>
        <span class="nv">evaluate    : </span><span class="nx">bindFunction</span>

      <span class="nv">isArray       :</span>
        <span class="nv">name        : </span><span class="s">&#39;isArray&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;iA&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                      (function(isArray) {</span>
<span class="s">                        return isArray || function(o){return _toString.call(o)===&#39;[object Array]&#39;;};</span>
<span class="s">                      })(Array.isArray)</span>
<span class="s">                      &quot;&quot;&quot;</span>
        <span class="nv">evaluate    : </span><span class="nx">isArray</span>

      <span class="nv">arraySlice    :</span>
        <span class="nv">name        : </span><span class="s">&#39;arraySlice&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;aS&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="c1">#code        : &#39;[].slice&#39;</span>
        <span class="nv">evaluate    : </span><span class="nx">arraySlice</span>

      <span class="nv">hasProperty   :</span>
        <span class="nv">name        : </span><span class="s">&#39;hasProperty&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;hP&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                      (function(hasProperty) {</span>
<span class="s">                        return function() {</span>
<span class="s">                          hasProperty.apply(arguments);</span>
<span class="s">                        };</span>
<span class="s">                      })({}.hasOwnProperty)</span>
<span class="s">                      &quot;&quot;&quot;</span>

      <span class="nv">isProperty    :</span>
        <span class="nv">name        : </span><span class="s">&#39;isProperty&#39;</span>
        <span class="nv">alias       : </span><span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&#39;iP&#39;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
        <span class="nv">code        : </span><span class="s">&quot;&quot;&quot;</span>
<span class="s">                      function() {</span>
<span class="s">                        if(_stack.length &lt; 2){return false;}</span>
<span class="s">                        var p = _stack.length &gt; 1 ? _stack[_stack.length-2] : void(0),</span>
<span class="s">                            c = _stack.length &gt; 0 ? _stack[_stack.length-1] : void(0);</span>
<span class="s">                        return p.toString() === &#39;</span><span class="si">#{</span><span class="nx">_operations</span><span class="p">[</span><span class="s">&#39;.&#39;</span><span class="p">].</span><span class="nx">alias</span><span class="si">}</span><span class="s">&#39; &amp;&amp; p[1] === c;</span>
<span class="s">                      }</span>
<span class="s">                      &quot;&quot;&quot;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><pre><code> Number        :
   name        : 'Number'
   alias       : if index is 0 then 'Nu' else aliases[--index]
   code        : "Number"
   evaluate    : Number
</code></pre></div></div><div class="code"><div class="wrapper">    <span class="nv">unwrap  = </span><span class="sr">/^function\s*\(([^\)]*)\)\s*\{\s*(\S[\s\S]*[;|\}])\s*\}$/</span>
    <span class="nv">pattern = </span><span class="p">[</span>
      <span class="sr">/(\s|\n)+/g</span>                 <span class="p">,</span> <span class="s">&#39; &#39;</span>
      <span class="o">/</span><span class="nx">_assignment</span><span class="o">/</span><span class="nx">g</span>              <span class="p">,</span> <span class="nx">_operations</span><span class="p">[</span><span class="s">&#39;=&#39;</span><span class="p">].</span><span class="nx">alias</span>
      <span class="sr">/_reference/g</span>               <span class="p">,</span> <span class="nx">_operations</span><span class="p">.</span><span class="nx">reference</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/_global/g</span>                  <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">global</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/_local/g</span>                   <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">local</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/_scope/g</span>                   <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/_stack/g</span>                   <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/_evaluate/g</span>                <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/_execute/g</span>                 <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">execute</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/_booleanize/g</span>              <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">booleanize</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/__slice\.call|arraySlice/g</span> <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">arraySlice</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/_slice/g</span>                   <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/_call/g</span>                    <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">call</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/([^\.])isArray/g</span>           <span class="p">,</span> <span class="s">&quot;$1</span><span class="si">#{</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">isArray</span><span class="p">.</span><span class="nx">alias</span><span class="si">}</span><span class="s">&quot;</span>
      <span class="o">/</span><span class="nx">_toString</span><span class="o">/</span><span class="nx">g</span>                <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/isNumber/g</span>                 <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">global</span><span class="p">.</span><span class="nx">alias</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><pre><code> /(Nu)mber/g                 , runtime.Number.alias
</code></pre></div></div><div class="code"><div class="wrapper">      <span class="sr">/isFunction/g</span>               <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/bindFunction/g</span>             <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">bindFunction</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/_isProperty/g</span>              <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">isProperty</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">/hasProperty/g</span>              <span class="p">,</span> <span class="nx">runtime</span><span class="p">.</span><span class="nx">hasProperty</span><span class="p">.</span><span class="nx">alias</span>
      <span class="sr">///</span>
<span class="sr">        ([a-zA-Z]+)\.hasOwnProperty\(</span>
<span class="sr">      ///g</span>                        <span class="p">,</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">hasProperty</span><span class="p">.</span><span class="nx">alias</span><span class="si">}</span><span class="s">($1,&quot;</span>
      <span class="o">/</span><span class="p">(</span><span class="nx">_l</span><span class="p">)</span><span class="nx">en</span><span class="o">/</span><span class="nx">g</span>                   <span class="p">,</span> <span class="k">if</span> <span class="nx">index</span> <span class="o">is</span> <span class="mi">0</span> <span class="k">then</span> <span class="s">&quot;$1&quot;</span> <span class="k">else</span> <span class="nx">aliases</span><span class="p">[</span><span class="o">--</span><span class="nx">index</span><span class="p">]</span>
      <span class="o">/</span><span class="nx">obj</span><span class="p">([</span><span class="o">^</span><span class="nx">e</span><span class="p">])</span><span class="o">|</span><span class="nx">item</span><span class="o">/</span><span class="nx">g</span>           <span class="p">,</span> <span class="s">&#39;o$1&#39;</span>
      <span class="o">/</span><span class="nx">value</span><span class="o">/</span><span class="nx">g</span>                    <span class="p">,</span> <span class="s">&#39;v&#39;</span>
      <span class="o">/</span><span class="err">\</span><span class="p">(</span><span class="nx">array</span><span class="p">,</span><span class="nx">start</span><span class="p">,</span><span class="nx">end</span><span class="err">\</span><span class="p">)</span><span class="o">/</span><span class="nx">g</span>      <span class="p">,</span> <span class="s">&#39;()&#39;</span>
      <span class="o">/</span><span class="p">([</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="err">\</span><span class="nx">s</span><span class="p">([</span><span class="o">^</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="nx">gi</span> <span class="p">,</span> <span class="s">&#39;$1$2&#39;</span>
      <span class="o">/</span><span class="p">([</span><span class="o">^</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="err">\</span><span class="nx">s</span><span class="p">([</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="nx">gi</span> <span class="p">,</span> <span class="s">&#39;$1$2&#39;</span>
      <span class="o">/</span><span class="p">([</span><span class="o">^</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="err">\</span><span class="nx">s</span><span class="p">([</span><span class="o">^</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="nx">gi</span><span class="p">,</span> <span class="s">&#39;$1$2&#39;</span>
      <span class="o">/</span><span class="p">([</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="err">\</span><span class="nx">s</span><span class="p">([</span><span class="o">^</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="nx">gi</span> <span class="p">,</span> <span class="s">&#39;$1$2&#39;</span>
      <span class="o">/</span><span class="p">([</span><span class="o">^</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="err">\</span><span class="nx">s</span><span class="p">([</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="nx">gi</span> <span class="p">,</span> <span class="s">&#39;$1$2&#39;</span>
      <span class="o">/</span><span class="p">([</span><span class="o">^</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="err">\</span><span class="nx">s</span><span class="p">([</span><span class="o">^</span><span class="nx">a</span><span class="o">-</span><span class="nx">z0</span><span class="o">-</span><span class="mi">9</span><span class="p">])</span><span class="o">/</span><span class="nx">gi</span><span class="p">,</span> <span class="s">&#39;$1$2&#39;</span>
      <span class="o">/</span><span class="k">return</span><span class="p">(</span><span class="err">\</span><span class="nx">S</span><span class="p">)</span><span class="o">/</span><span class="nx">gi</span>              <span class="p">,</span> <span class="s">&#39;return $1&#39;</span>
    <span class="p">]</span>
    <span class="nv">clean  = </span><span class="nf">(key, value, code) -&gt;</span>
      <span class="k">for</span> <span class="nx">search</span><span class="p">,</span> <span class="nx">index</span> <span class="k">in</span> <span class="nx">pattern</span> <span class="k">by</span> <span class="mi">2</span>
        <span class="nv">code = </span><span class="nx">code</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">search</span><span class="p">,</span> <span class="nx">pattern</span><span class="p">[</span><span class="nx">index</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>

      <span class="k">if</span> <span class="nx">key</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">key</span><span class="p">[</span><span class="nx">key</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">is</span> <span class="s">&#39;=&#39;</span>
        <span class="nv">alias = </span><span class="nx">_operations</span><span class="p">[</span><span class="nx">key</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nx">key</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)].</span><span class="nx">alias</span>
        <span class="nv">code = </span><span class="nx">code</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s">&#39;_op&#39;</span><span class="p">,</span> <span class="nx">alias</span><span class="p">)</span>

      <span class="nx">code</span>

    <span class="nv">vars = </span><span class="p">[]</span>
    <span class="nv">body = </span><span class="p">[]</span>

    <span class="nv">assemble = </span><span class="nf">(object) -&gt;</span>
      <span class="k">for</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span> <span class="k">of</span> <span class="nx">object</span> <span class="k">when</span> <span class="nx">value</span><span class="p">.</span><span class="nx">name</span><span class="o">?</span>
        <span class="nv">code = </span><span class="nx">clean</span><span class="p">(</span>
          <span class="nx">key</span><span class="p">,</span> <span class="nx">value</span><span class="p">,</span>
          <span class="k">if</span> <span class="nx">value</span><span class="p">.</span><span class="nx">code</span><span class="o">?</span> <span class="k">then</span> <span class="nx">value</span><span class="p">.</span><span class="nx">code</span> <span class="k">else</span> <span class="nx">value</span><span class="p">.</span><span class="nx">evaluate</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="nx">vars</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span>
          <span class="s">&#39;/* &#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="s">&#39; */ &#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="p">.</span><span class="nx">alias</span>
        <span class="p">].</span><span class="nx">join</span> <span class="s">&#39;&#39;</span>
        <span class="nx">body</span><span class="p">.</span><span class="nx">push</span> <span class="p">[</span>
          <span class="s">&#39;/* &#39;</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="s">&#39; */ &#39;</span><span class="p">,</span>
          <span class="nx">value</span><span class="p">.</span><span class="nx">alias</span><span class="p">,</span> <span class="s">&#39;=&#39;</span><span class="p">,</span> <span class="nx">code</span>
        <span class="p">].</span><span class="nx">join</span> <span class="s">&#39;&#39;</span>

    <span class="nx">assemble</span> <span class="nx">runtime</span>
    <span class="nx">assemble</span> <span class="nx">_operations</span>

    <span class="nv">code = </span><span class="s">&quot;var </span><span class="si">#{</span><span class="nx">vars</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;,\n&#39;</span><span class="si">}</span><span class="s">;\n</span><span class="si">#{</span><span class="nx">body</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;;\n&#39;</span><span class="si">}</span><span class="s">;&quot;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>remove comments and linebreaks</p></div></div><div class="code"><div class="wrapper">    <span class="nv">js = </span><span class="nx">code</span>
      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/\/\*(?:.|[\r\n])*?\*\/\s*|/g</span>   <span class="p">,</span> <span class="s">&#39;&#39;</span>  <span class="p">)</span>
      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/\s*[;]\s*[\}]/g</span>                <span class="p">,</span> <span class="s">&#39;}&#39;</span> <span class="p">)</span>
      <span class="p">.</span><span class="nx">replace</span><span class="p">(</span> <span class="sr">/([,;])[\r\n]/g</span>                 <span class="p">,</span> <span class="s">&#39;$1&#39;</span><span class="p">)</span>

    <span class="nf">(compress=on) -&gt;</span>
      <span class="k">if</span> <span class="nx">compress</span> <span class="o">is</span> <span class="kc">on</span> <span class="k">then</span> <span class="nx">js</span> <span class="k">else</span> <span class="nx">code</span></div></div></div></div></body></html>