<!DOCTYPE html><html lang="en"><head><title>gulpfile</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content=""><meta name="groc-document-path" content="gulpfile"><meta name="groc-project-path" content="gulpfile.coffee"><link rel="stylesheet" type="text/css" media="all" href="assets/style.css"><script type="text/javascript" src="assets/behavior.js"></script><body><div id="meta"><div class="file-path">gulpfile.coffee</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper">gulp = <span class="hljs-built_in">require</span> <span class="hljs-string">'gulp'</span>

coffee = <span class="hljs-built_in">require</span> <span class="hljs-string">'gulp-coffee'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>cson = require &#39;gulp-cson&#39;</p></div></div><div class="code"><div class="wrapper">cson = <span class="hljs-built_in">require</span> <span class="hljs-string">"<span class="hljs-subst">#{__dirname}</span>/src/misc/gulp/gulp-cson"</span>
del = <span class="hljs-built_in">require</span> <span class="hljs-string">'del'</span>
groc = <span class="hljs-built_in">require</span> <span class="hljs-string">'gulp-groc'</span>
rename = <span class="hljs-built_in">require</span> <span class="hljs-string">'gulp-rename'</span>
replace = <span class="hljs-built_in">require</span> <span class="hljs-string">'gulp-replace'</span>
sequence = <span class="hljs-built_in">require</span> <span class="hljs-string">'run-sequence'</span>
sourcemaps = <span class="hljs-built_in">require</span> <span class="hljs-string">'gulp-sourcemaps'</span>
taskqueue = <span class="hljs-built_in">require</span> <span class="hljs-string">"<span class="hljs-subst">#{__dirname}</span>/src/misc/gulp/gulp-taskqueue"</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>logger = require &#39;gulp-logger&#39;</p></div></div><div class="code"><div class="wrapper">util = <span class="hljs-built_in">require</span> <span class="hljs-string">'gulp-util'</span>

<span class="hljs-built_in">require</span> <span class="hljs-string">'require-cson'</span> <span class="hljs-comment"># only needed for coffee-script execution</span>

deps = taskqueue.createDependencyLog()
<span class="hljs-function">
<span class="hljs-title">load</span> = <span class="hljs-params">(filename)</span> -&gt;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>require &quot;goatee-script/misc/gulp/tasks/#{filename}.json&quot;</p></div></div><div class="code"><div class="wrapper">  <span class="hljs-built_in">require</span> <span class="hljs-string">"<span class="hljs-subst">#{__dirname}</span>/src/misc/gulp/tasks/<span class="hljs-subst">#{filename}</span>.cson"</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>Task: Transpile coffee-script to javascript</p></div></div><div class="code"><div class="wrapper">task = <span class="hljs-string">'coffee:transpile'</span>
deps = taskqueue.build task, deps, load, \
  (source, destination, name, config) -&gt;
    -&gt;
      util.log name, source, destination

      sm = config.sourcemaps ? <span class="hljs-literal">false</span>

      pipe = gulp.src.apply(gulp, source)
      pipe = pipe.pipe logger(config.logger) <span class="hljs-keyword">if</span> logger? <span class="hljs-keyword">and</span> config.logger?
      <span class="hljs-keyword">if</span> config.replace?
        <span class="hljs-keyword">for</span> replacement <span class="hljs-keyword">in</span> config.replace
          pipe = pipe.pipe replace.apply(<span class="hljs-literal">null</span>, replacement)
      pipe = pipe.pipe sourcemaps.init.apply(sourcemaps, sm.init) <span class="hljs-keyword">if</span> sm
      pipe = pipe.pipe coffee(config.defaults).<span class="hljs-literal">on</span>(<span class="hljs-string">'error'</span>, util.log)
      pipe = pipe.pipe sourcemaps.write.apply(sourcemaps, sm.write) <span class="hljs-keyword">if</span> sm
      pipe = pipe.pipe rename(config.rename) <span class="hljs-keyword">if</span> config.rename?
      pipe.pipe gulp.dest(destination)

gulp.task task, deps.queue
deps.transpile.push task</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>Task: Transpile cson to json</p></div></div><div class="code"><div class="wrapper">task = <span class="hljs-string">'cson:transpile'</span>
deps = taskqueue.build task, deps, load, \
  (source, destination, name, config) -&gt;
    -&gt;
      util.log name, source, destination

      pipe = gulp.src.apply(gulp, source)
      pipe = pipe.pipe logger(config.logger) <span class="hljs-keyword">if</span> logger? <span class="hljs-keyword">and</span> config.logger?
      <span class="hljs-keyword">if</span> config.replace?
        <span class="hljs-keyword">for</span> replacement <span class="hljs-keyword">in</span> config.replace
          pipe = pipe.pipe replace.apply(<span class="hljs-literal">null</span>, replacement)
      pipe = pipe.pipe cson(config.defaults).<span class="hljs-literal">on</span>(<span class="hljs-string">'error'</span>, util.log)
      pipe = pipe.pipe rename(config.rename) <span class="hljs-keyword">if</span> config.rename?
      pipe.pipe gulp.dest destination

gulp.task task, deps.queue
deps.transpile.push task</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>Task: Transpile</p></div></div><div class="code"><div class="wrapper">gulp.task <span class="hljs-string">'transpile'</span>, deps.transpile, <span class="hljs-function">-&gt;</span> util.log <span class="hljs-string">'Transpiling done'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>Task: Create documenation with groc</p></div></div><div class="code"><div class="wrapper">task = <span class="hljs-string">'groc:doc'</span>
deps = taskqueue.build task, deps, load, \
  (source, destination, name, config) -&gt;
    -&gt;
      util.log name, source, destination
      defaults = taskqueue.cloneObject config.defaults
      defaults.out = destination
      defaults.silent = <span class="hljs-literal">true</span> <span class="hljs-keyword">unless</span> logger?

      pipe = gulp.src.apply(gulp, source)
      pipe = pipe.pipe logger(config.logger) <span class="hljs-keyword">if</span> logger? <span class="hljs-keyword">and</span> config.logger?
      <span class="hljs-keyword">if</span> config.replace?
        <span class="hljs-keyword">for</span> replacement <span class="hljs-keyword">in</span> config.replace
          pipe = pipe.pipe replace.apply(<span class="hljs-literal">null</span>, replacement)
      pipe = pipe.pipe groc(defaults)

gulp.task task, deps.queue
deps.doc.push task</div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>Task: Documentation</p></div></div><div class="code"><div class="wrapper">gulp.task <span class="hljs-string">'doc'</span>, deps.doc, <span class="hljs-function">-&gt;</span> util.log <span class="hljs-string">'Documentation updated'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>Task: Clean</p></div></div><div class="code"><div class="wrapper">gulp.task <span class="hljs-string">'clean'</span>, deps.clean, <span class="hljs-function">-&gt;</span> util.log <span class="hljs-string">'Everything clean'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>Task: Default</p></div></div><div class="code"><div class="wrapper">gulp.task <span class="hljs-string">'build'</span>, <span class="hljs-function"><span class="hljs-params">(callback)</span> -&gt;</span>
  sequence <span class="hljs-string">'clean'</span>, <span class="hljs-string">'transpile'</span>, <span class="hljs-string">'doc'</span>, <span class="hljs-function"><span class="hljs-params">(error)</span> -&gt;</span>
    util.log error.message <span class="hljs-keyword">if</span> error?
    callback error
  util.log <span class="hljs-string">'Build done'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>Task: Publish</p></div></div><div class="code"><div class="wrapper">gulp.task <span class="hljs-string">'publish'</span>, deps.publish, <span class="hljs-function">-&gt;</span>  util.log <span class="hljs-string">'Published'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>Task: Watch</p></div></div><div class="code"><div class="wrapper">gulp.task <span class="hljs-string">'watch'</span>, deps.watch, <span class="hljs-function">-&gt;</span> util.log <span class="hljs-string">'Watcher running'</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><hr>
<p>Task: Default</p></div></div><div class="code"><div class="wrapper">gulp.task <span class="hljs-string">'default'</span>, [<span class="hljs-string">'build'</span>]</div></div></div></div></body></html>